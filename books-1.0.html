<html>

<head>
  <Title>Books of the Bible</Title>

  <script src="updateTable.mjs"></script>
</head>

<body>
  <H1>Books of the Bible</H1>

  <p id="context">
    In <b>BibleModel</b> initialization of the class <b>Bible</b> stage 2 of the state machine reads a database and
    creates a json file named <STRONG>books.json</STRONG>.
  </p>

  <p id="what">
    This page simply reads that in and displays it as a Table.
  <p>
  <h2>The raw data file <a href="books.json">books.json:</a> </h2>

  <p>
    <h2>This is where the raw json object should go.</h2>

    <p id="booksParagraph">
        This is where the raw json text read from books.json should show.
    </p>
  <h2>This is where the table should go.</h2>

  <table id="booksTable">

  </table>

  <script type="module">

    const booksJsonPathname = "./books.json";
    let booksText = 'initialized text';
    let booksParagraph = document.getElementById('booksParagraph');
    let booksTable = document.getElementById('booksTable');
    let booksError;
    let booksArray;
    let enable = true;
    if (enable == true) {
      try {
        console.log('Next step is to fetch books.json file.');
         await fetch(booksJsonPathname,
                {
                  mode: 'no-cors'
                }
        ).then((response) => response.json())
                .then((booksResult) =>
                {
                  console.log("booksJSON=", booksArray);
                  booksArray = booksResult;
                  booksText = JSON.stringify(booksArray);
                });
      } catch(error) {
        console.log("Error trying to fetch books.json: ",error);
        booksError = JSON.stringify(error);
        console.log("Error fetching file ", booksJsonPathname, " : ", booksError);
      }

    }
    else
      console.log('fetch disabled.');

    // Display the results on the web page.
    booksParagraph.innerHTML = booksText;
    updateTable(booksTable,booksArray);

  </script>

</body>

</html>