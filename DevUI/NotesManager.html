<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Notes Manager</title>


  <script type="module">
    // NotesManager.mjs is the main logic behind this page.
    // This html page is mainly the anchor for a dynamic page created and manipulated
    // by the NotesManager class.
    import { NotesManager } from './NotesManager.mjs';
    const notesManager = new NotesManager();
    console.log(`Init notesManager: ${notesManager}`);
    const readLocalNotes = function readLocalNotes() {
      NotesManager.readLocalNotes();
    }
  </script>

  <link rel="stylesheet" href="ErrorTips.css">

</head>
<body>

<h1>BibleModel notes manager.</h1>

<h2>Contents:</h2>
<ol>
  <a href="#explanation"><li>Explanation</li></a>
  <a href="#localNotes"><li>Notes stored locally in the web browser</li></a>
  <a href="#localNotes"><li>Notes stored in the BibleModel server</li></a>
</ol>

<div id="explanation">
  <h2>Explanation:</h2>
  <details>
    <summary>Read more...</summary>
    <p>
  The <a href="https://github.com/MichaelKentBurns/BibleModel">BibleModel project</a>
  presents the text and cross references of the Bible.   The source of that text is
  one of several possible SQL databases.  However, those public databases do not provide
  a suitable way to store notes, which is a key feature of BibleModel.  Also, the user may
  choose to switch to a different version of the Bible without loosing his notes.
    </p>
<p>
  This page is the central user interface for creating,
  editing and associating notes with the context that they describe.
  There are two places for notes to be stored:
</p>
  <h3>Local Notes</h3>
  As notes are created and edited they are stored in in Web Browser's local storage until
  the user is ready to publish them to the permanent database. Note that these are stored
    in a specific web browser on a specific computer.

    <h3>Published Notes</h3>
    After notes are created and edited as local notes in the browser,
    the user can publish them to their personal Bible library.  Published notes
    will then be available on any web browser that is logged into the BibleModel server.

  </details>
</div>


<div id="localNotes">
  <h2>Local Notes:</h2>
  <br>
  <button id='readLocalNotes'>Get Local Notes</button>
  Automatic<input type="checkbox" id="autoReadLocalNotes"/>
  <br>
  <button id="newNote">New Note</button>
  <p>
  <table id="localNotesTable" style='border: thin double black'>
  </table>
  </p>
  <br>
  <button id="writeLocalNotes">Save Notes</button>
  <button id="deleteLocalNotes">Delete Selected Notes</button>
  <button id="publishNotes">Publish Selected Notes</button>
</div>

<div id="publishedNotes">
  <h2>Published Notes:</h2>
  <br>
  <button id="readPublishedNotes">Get Published Notes</button>
  Automatic<input type="checkbox" id="autoReadPublishedNotes"/>
<p>
  <table id="publishedNotesTable" style='border: thin double black'>
  </table>
  </p>
  <br>
  <button id="deletePublishedNotes">Delete Selected Notes</button>
  <button id="writePublishedNotes()">Update Published Notes</button>
</div>

<script type="module">
  import { NotesManager } from './NotesManager.mjs';
  let theNotesManager = NotesManager.getNotesManager();
  let doRefreshLocal = false;
  let doRefreshPublished = false;

  // Glue the elements into the controlling NotesManager.
  NotesManager.setLocalNotesTable(document.getElementById('localNotesTable'));
  NotesManager.setServerNotesTable(document.getElementById('publishedNotesTable'));
  const autoReadLocalNotesElement = document.getElementById('autoReadLocalNotes');
  const autoReadPublishedNotesElement = document.getElementById('autoReadPublishedNotes');
  autoReadLocalNotesElement.checked = theNotesManager.preferences.notes.autoReadLocalNotesElement;
  autoReadPublishedNotesElement.checked = theNotesManager.preferences.notes.autoReadPublishedNotesElement;

  function saveAutoReadLocalNotes() {
    theNotesManager.preferences.notes.autoReadLocalNotesElement = autoReadLocalNotesElement.checked;
  }

  function saveAutoReadPublishedNotes() {
    theNotesManager.preferences.notes.autoReadPublishedNotesElement = autoReadPublishedNotesElement.checked;
  }

  if (autoReadLocalNotesElement.checked) {
    NotesManager.readLocalNotes();
    doRefreshLocal = true;
  };
  autoReadLocalNotesElement.onchange = function(ev) {
    saveAutoReadLocalNotes();
  }
  if (doRefreshLocal) NotesManager.refreshLocalNotesTable();

  if (autoReadPublishedNotesElement.checked) {
    NotesManager.readPublishedNotes();
    doRefreshPublished = true;
  };
  autoReadPublishedNotesElement.onchange = function(value) {
    saveAutoReadPublishedNotes(value);
  }

  if (doRefreshPublished) NotesManager.refreshPublishedNotesTable();
  function readLocalNotes() {
    NotesManager.readLocalNotes(); }
  document.getElementById('readLocalNotes').addEventListener('click', readLocalNotes);

  function writeLocalNotes() {
    NotesManager.writeLocalNotes(); }
  document.getElementById('writeLocalNotes').addEventListener('click', writeLocalNotes);

  function readPublishedNotes() {
    NotesManager.readPublishedNotes(); }
  document.getElementById('readPublishedNotes').addEventListener('click', readPublishedNotes);


  window.addEventListener('beforeunload', function (e) {
    e.preventDefault();
    e.returnValue = '';
    NotesManager.writeLocalNotes();
   // NotesManager.writePublishedNotes();

    NotesManager.savePreferences();

    alert('NotesManager state has been saved.');
  });

  console.log(`Init notesManager complete.`, theNotesManager);
</script>
</body>
</html>